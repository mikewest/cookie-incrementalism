<!DOCTYPE html>
<html lang="en" class="Internet-Draft">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>Incrementally Better Cookies</title>
<meta content="Mike West" name="author">
<meta content="
       This document proposes a few changes to cookies inspired by the properties of
the HTTP State Tokens mechanism proposed in  .
First, cookies should be treated as  SameSite=Lax  by default. Second, cookies
that explicitly assert  SameSite=None  in order to enable cross-site delivery
should also be marked as  Secure . Third, same-site should take the scheme of
the sites into account. Fourth, cookies should respect schemes. Fifth, cookies
associated with non-secure schemes should be removed at the end of a user's
session. Sixth, the definition of a session should be tightened. 
    " name="description">
<meta content="xml2rfc 3.6.0" name="generator">
<meta content="Internet-Draft" name="keyword">
<meta content="draft-west-cookie-incrementalism-latest" name="ietf.draft">
<!-- Generator version information:
  xml2rfc 3.6.0
    Python 3.8.7
    appdirs 1.4.4
    ConfigArgParse 1.4
    google-i18n-address 2.4.0
    html5lib 1.1
    intervaltree 3.1.0
    Jinja2 2.11.3
    kitchen 1.2.6
    lxml 4.6.2
    pycairo 1.16.2
    pycountry 20.7.3
    pyflakes 2.3.1
    PyYAML 5.3.1
    requests 2.25.1
    setuptools 52.0.0
    six 1.15.0
-->
<link href="draft-west-cookie-incrementalism.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">@import url('https://martinthomson.github.io/i-d-template/fonts.css');

html {
  --background-color: #fff;
  --text-color: #222;
  --title-color: #191919;
  --link-color: #2a6496;
  --highlight-color: #f9f9f9;
  --line-color: #eee;
  --small-font-size: 14.5px;
}
body {
  max-width: 600px;
  margin: 75px auto;
  padding: 0 5px;
  color: var(--text-color);
  background-color: var(--background-color);
  font: 16px/22px "Lora", serif;
  scroll-behavior: smooth;
}

.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  font-family: "Cabin Condensed", sans-serif;
  font-weight: 600;
  margin: 0.8em 0 0.3em;
  font-size-adjust: 0.5;
  color: var(--title-color);
}
#title {
  padding: 1em 0 0.2em;
  font-size: 32px;
  line-height: 40px;
  clear: both;
}
h1, h2, h3 {
  font-size: 22px;
  line-height: 26px;
}
h4, h5, h6 {
  font-size: 18px;
  line-height: 22px;
}

/* general structure */
.author {
  padding-bottom: 0.3em;
}
#abstract+p, #abstract+p code, #abstract+p samp, #abstract+p tt {
  font-size: 18px;
  line-height: 24px;
}
p {
  padding: 0;
  margin: 0.5em 0;
  text-align: left;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignRight.art-text pre {
  padding: 0;
  width: auto;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  padding: 0.5em 1em 0;
  margin-bottom: 0.5em;
}
.alignCenter.art-text pre {
  padding: 0;
  width: auto;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
dd.break {
  display: none;
}

/* links */
a, a[href].selfRef:hover {
  text-decoration: none;
}
a[href].selfRef {
  color: var(--text-color);
}
a[href] {
  color: var(--link-color);
}
a[href]:hover {
  text-decoration: underline;
}
a[href].selfRef:hover {
  background-color: var(--highlight-color);
}
a.xref {
  white-space: nowrap;
}

/* Figures */
tt, code, pre {
  background-color: var(--highlight-color);
  font: 14px/22px 'Oxygen Mono', monospace;
}
pre {
  border: 1px solid var(--line-color);
  font-size: 13.5px;
  line-height: 16px;
  letter-spacing: -0.2px;
  margin: 5px;
  padding: 5px;
}
img {
  max-width: 100%;
}
figure {
  margin: 0.5em 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption, caption {
  font-style: italic;
  margin: 0.5em 1.5em;
  text-align: left;
}
@media screen {
  pre {
    display: inline-block;
    overflow-x: auto;
    max-width: 100%;
    width: calc(100% - 22px - 1em);
  }
  figure pre {
    display: block;
    width: calc(100% - 25px);
  }
  pre + .pilcrow {
    display: inline-block;
    vertical-align: text-bottom;
    padding-bottom: 8px;
  }
  table {
    display: inline-block;
    overflow-x: auto;
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 0 2em;
  font-style: italic;
}
blockquote {
  background-color: var(--highlight-color);
  border: 1px solid var(--line-color);
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  max-width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
}
table.right {
  margin-left: auto;
}
table.center {
  margin-left: auto;
  margin-right: auto;
}
table.left {
  margin-right: auto;
}
thead, tbody {
  border: 1px solid var(--line-color);
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 5px 10px;
}
th {
  background-color: var(--line-color);
}
tr:nth-child(2n) > td {
  background-color: var(--background-color);
}
tr:nth-child(2n+1) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n) > td {
  background-color: var(--highlight-color);
}
thead+tbody > tr:nth-child(2n+1) > td {
  background-color: var(--background-color);
}
table caption {
  margin: 0;
  padding: 3px 1em;
}
table p {
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  margin-left: 3px;
  visibility: hidden;
  user-select: none;
}
a.pilcrow[href] { color: #ddd; }
a.pilcrow[href]:hover { text-decoration: none; }
@media screen {
  :hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid var(--line-color);
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: var(--small-font-size);
  line-height: 18px;
  --identifier-width: 8em;
}
#identifiers dt {
  width: var(--identifier-width);
  margin: 0;
  clear: left;
  float: left;
  text-align: right;
}
#identifiers dd {
  margin: 0 0 0 calc(1em + var(--identifier-width));
  min-width: 5em;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #999;
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
#toc nav ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
#toc nav li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
#toc a.xref {
  white-space: normal;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 500px) {
  .index ul {
    column-count: 2;
    column-gap: 20px;
  }
  .index ul ul {
    column-count: 1;
    column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}
address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}
@media (min-width: 500px) {
  #authors-addresses > section {
    column-count: 2;
    column-gap: 20px;
  }
  #authors-addresses > section > h2 {
    column-span: all;
  }
  /* hack for break-inside: avoid-column */
  #authors-addresses address {
    display: inline-block;
    break-inside: avoid-column;
  }
}

.rfcEditorRemove p:first-of-type {
  font-style: italic;
}
.cref {
  background-color: rgba(249, 232, 105, 0.3);
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 929px) {
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    border-bottom: 1px solid #ccc;
    opacity: 0.6;
  }
  #toc.active {
      opacity: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 2px 0 2px 6px;
    padding-right: 1em;
    font-size: 18px;
    line-height: 24px;
    min-width: 190px;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 8px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    background-color: var(--background-color);
    padding: 0.5em 1em 1em;
    overflow: auto;
    overscroll-behavior: contain;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
  #toc.active nav {
    display: block;
  }
  /* Make the collapsed ToC header render white on gray also when it's a link */
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
  #toc a.toplink {
    margin-top: 2px;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 930px) {
  body {
    padding-right: 360px;
    padding-right: calc(min(180px + 20%, 500px));
  }
  #toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 480px);
    width: 312px;
    margin: 0;
    padding: 0;
    z-index: 1;
  }
  #toc h2 {
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 2em;
    overflow: auto;
    overscroll-behavior: contain;
    scrollbar-width: thin;
  }
  #toc nav > ul  {
    margin-bottom: 2em;
  }
  #toc ul {
    margin: 0 0 0 4px;
    font-size: var(--small-font-size);
  }
  #toc ul p, #toc ul li {
    margin: 2px 0;
    line-height: 22px;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {
    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
}

/* Changes introduced to fix issues found during implementation */

/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}

/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin: 8px 0.5em 0;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table .text-left, table .text-left {
  text-align: left;
}
table .text-center, table .text-center {
  text-align: center;
}
table .text-right, table .text-right {
  text-align: right;
}

/* Make the alternative author contact information look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 20em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Give the table caption label the same styling as the figcaption */

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  dd {
    page-break-before: avoid;
  }
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
</head>
<body>
<table class="ears">
<thead><tr>
<td class="left">Internet-Draft</td>
<td class="center">cookie-incrementalism</td>
<td class="right">March 2021</td>
</tr></thead>
<tfoot><tr>
<td class="left">West</td>
<td class="center">Expires 30 September 2021</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-workgroup">Workgroup:</dt>
<dd class="workgroup">Network Working Group</dd>
<dt class="label-internet-draft">Internet-Draft:</dt>
<dd class="internet-draft">draft-west-cookie-incrementalism-latest</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2021-03-29" class="published">29 March 2021</time>
    </dd>
<dt class="label-intended-status">Intended Status:</dt>
<dd class="intended-status">Standards Track</dd>
<dt class="label-expires">Expires:</dt>
<dd class="expires"><time datetime="2021-09-30">30 September 2021</time></dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. West</div>
<div class="org">Google</div>
</div>
</dd>
</dl>
</div>
<h1 id="title">Incrementally Better Cookies</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document proposes a few changes to cookies inspired by the properties of
the HTTP State Tokens mechanism proposed in <span>[<a href="#I-D.west-http-state-tokens" class="xref">I-D.west-http-state-tokens</a>]</span>.
First, cookies should be treated as <code>SameSite=Lax</code> by default. Second, cookies
that explicitly assert <code>SameSite=None</code> in order to enable cross-site delivery
should also be marked as <code>Secure</code>. Third, same-site should take the scheme of
the sites into account. Fourth, cookies should respect schemes. Fifth, cookies
associated with non-secure schemes should be removed at the end of a user's
session. Sixth, the definition of a session should be tightened.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
        This Internet-Draft is submitted in full conformance with the
        provisions of BCP 78 and BCP 79.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
        Internet-Drafts are working documents of the Internet Engineering Task
        Force (IETF). Note that other groups may also distribute working
        documents as Internet-Drafts. The list of current Internet-Drafts is
        at <span><a href="https://datatracker.ietf.org/drafts/current/">https://datatracker.ietf.org/drafts/current/</a></span>.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
        Internet-Drafts are draft documents valid for a maximum of six months
        and may be updated, replaced, or obsoleted by other documents at any
        time. It is inappropriate to use Internet-Drafts as reference
        material or to cite them other than as "work in progress."<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-4">
        This Internet-Draft will expire on 30 September 2021.<a href="#section-boilerplate.1-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1"><a href="#section-2" class="xref">2</a>.  <a href="#name-conventions-and-definitions" class="xref">Conventions and Definitions</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.2.2.1">
                <p id="section-toc.1-1.2.2.1.1" class="keepWithNext"><a href="#section-2.1" class="xref">2.1</a>.  <a href="#name-conformance" class="xref">Conformance</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.2.2.2">
                <p id="section-toc.1-1.2.2.2.1" class="keepWithNext"><a href="#section-2.2" class="xref">2.2</a>.  <a href="#name-syntax" class="xref">Syntax</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-monkey-patches-against-rfc6" class="xref">Monkey-Patches against RFC6265bis</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-lax-by-default" class="xref">"Lax" by Default</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.3.2.1.2.1">
                    <p id="section-toc.1-1.3.2.1.2.1.1"><a href="#section-3.1.1" class="xref">3.1.1</a>.  <a href="#name-lax-allowing-unsafe-enforce" class="xref">"Lax-Allowing-Unsafe" Enforcement</a></p>
</li>
                </ul>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-requiring-secure-for-samesi" class="xref">Requiring "Secure" for "SameSite=None"</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-schemeful-same-site" class="xref">Schemeful Same-Site</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.4">
                <p id="section-toc.1-1.3.2.4.1"><a href="#section-3.4" class="xref">3.4</a>.  <a href="#name-origin-bound-cookies" class="xref">Origin-Bound Cookies</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.5">
                <p id="section-toc.1-1.3.2.5.1"><a href="#section-3.5" class="xref">3.5</a>.  <a href="#name-evict-non-secure-cookies" class="xref">Evict Non-Secure Cookies</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.3.2.6">
                <p id="section-toc.1-1.3.2.6.1"><a href="#section-3.6" class="xref">3.6</a>.  <a href="#name-session-lifetime" class="xref">Session Lifetime</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-security-and-privacy-consid" class="xref">Security and Privacy Considerations</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-csrf" class="xref">CSRF</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-secure-transport" class="xref">Secure Transport</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.4.2.3">
                <p id="section-toc.1-1.4.2.3.1"><a href="#section-4.3" class="xref">4.3</a>.  <a href="#name-tracking" class="xref">Tracking</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-implementation-consideratio" class="xref">Implementation Considerations</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.5.2.1">
                <p id="section-toc.1-1.5.2.1.1"><a href="#section-5.1" class="xref">5.1</a>.  <a href="#name-sequencing" class="xref">Sequencing</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.5.2.2">
                <p id="section-toc.1-1.5.2.2.1"><a href="#section-5.2" class="xref">5.2</a>.  <a href="#name-deployment" class="xref">Deployment</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-references" class="xref">References</a></p>
<ul class="toc ulEmpty compact">
<li class="toc ulEmpty compact" id="section-toc.1-1.7.2.1">
                <p id="section-toc.1-1.7.2.1.1"><a href="#section-7.1" class="xref">7.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a></p>
</li>
              <li class="toc ulEmpty compact" id="section-toc.1-1.7.2.2">
                <p id="section-toc.1-1.7.2.2.1"><a href="#section-7.2" class="xref">7.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a></p>
</li>
            </ul>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a></p>
</li>
          <li class="toc ulEmpty compact" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">The HTTP State Tokens proposal (<span>[<a href="#I-D.west-http-state-tokens" class="xref">I-D.west-http-state-tokens</a>]</span>) aims to replace cookies with
a state management mechanism that has better security and privacy properties. That proposal is
somewhat aspirational: it's going to take a long time to come to agreement on the exact contours
of a cookie replacement, and an even longer time to actually do so.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">While we're debating the details of a new state management primitive, it seems quite reasonable to
reevaluate some aspects of the existing primitive: cookies. When we can find consensus on some
aspect of HTTP State Tokens, we can apply those aspirations to cookies, driving incremental
improvements to state management in the status quo.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Based on conversations at <span>[<a href="#HTTP-Workshop-2019" class="xref">HTTP-Workshop-2019</a>]</span> and elsewhere, I'd suggest that we have something
like agreement on at least three principles:<a href="#section-1-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-4">
<li id="section-1-4.1">HTTP requests should not carry state along with cross-site requests by default (see Section 8.2
of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>).<a href="#section-1-4.1" class="pilcrow">¶</a>
</li>
        <li id="section-1-4.2">HTTP requests should not carry state over non-secure channels (see Section 8.3 of
<span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>, and <span>[<a href="#RFC7258" class="xref">RFC7258</a>]</span>).<a href="#section-1-4.2" class="pilcrow">¶</a>
</li>
        <li id="section-1-4.3">Non-secure channels should not be able to infuence the state of securely-transported content
(see Sections 8.3, 8.5, and 8.6 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>).<a href="#section-1-4.3" class="pilcrow">¶</a>
</li>
      </ol>
<p id="section-1-5">With those principles in mind, this document proposes a few changes that seem possible to deploy in
the near-term. User agents should:<a href="#section-1-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-1-6">
<li id="section-1-6.1">
          <p id="section-1-6.1.1">Treat the lack of an explicit <code>SameSite</code> attribute as <code>SameSite=Lax</code>. That is, the <code>Set-Cookie</code>
value <code>key=value</code> will produce a cookie equivalent to <code>key=value; SameSite=Lax</code>. Cookies that
require cross-site delivery can explicitly opt-into such behavior by asserting <code>SameSite=None</code>
when creating a cookie.<a href="#section-1-6.1.1" class="pilcrow">¶</a></p>
<p id="section-1-6.1.2">
This is spelled out in more detail in <a href="#lax-default" class="xref">Section 3.1</a>.<a href="#section-1-6.1.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-6.2">
          <p id="section-1-6.2.1">Require the <code>Secure</code> attribute to be set for any cookie which asserts <code>SameSite=None</code> (similar
conceptually to the behavior for the <code>__Secure-</code> prefix). That is, the <code>Set-Cookie</code> value
<code>key=value; SameSite=None; Secure</code> will be accepted, while <code>key=value; SameSite=None</code> will be
rejected.<a href="#section-1-6.2.1" class="pilcrow">¶</a></p>
<p id="section-1-6.2.2">
This is spelled out in more detail in <a href="#require-secure" class="xref">Section 3.2</a>.<a href="#section-1-6.2.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-6.3">
          <p id="section-1-6.3.1">Require both the scheme and registrable domain of a request's client's "site for cookies"
to match the target URL when deciding whether a given request is considered same-site.
That is, a request initiated from "http://site.example" to "https://site.example" should be
considered cross-site.<a href="#section-1-6.3.1" class="pilcrow">¶</a></p>
<p id="section-1-6.3.2">
This is spelled out in more detail in <a href="#schemeful-samesite" class="xref">Section 3.3</a>.<a href="#section-1-6.3.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-6.4">
          <p id="section-1-6.4.1">Separate cookies by origin. That is, a given cookie set from
<code>http://example.com/</code> should be considered distinct from the same
cookie set from <code>https://example.com/</code> which should again be
considered distinct from the same cookie set from
<code>https://example.com:123/</code>, preventing any origin from influencing the
state of any other.<a href="#section-1-6.4.1" class="pilcrow">¶</a></p>
<p id="section-1-6.4.2">
This is spelled out in more detail in <a href="#origin-bound-cookies" class="xref">Section 3.4</a>.<a href="#section-1-6.4.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-6.5">
          <p id="section-1-6.5.1">Evict non-secure cookies when a user's session on a non-secure site ends, thereby reducing the
timespan over which a user broadcasts a stable identifier to the network.<a href="#section-1-6.5.1" class="pilcrow">¶</a></p>
<p id="section-1-6.5.2">
This is spelled out in more detail in <a href="#evict-nonsecure" class="xref">Section 3.5</a>.<a href="#section-1-6.5.2" class="pilcrow">¶</a></p>
</li>
        <li id="section-1-6.6">
          <p id="section-1-6.6.1">Tighten the definition of a user's "session" with heuristics that better represent users'
expectations.<a href="#section-1-6.6.1" class="pilcrow">¶</a></p>
<p id="section-1-6.6.2">
This is spelled out in more detail in <a href="#session-lifetime" class="xref">Section 3.6</a>.<a href="#section-1-6.6.2" class="pilcrow">¶</a></p>
</li>
      </ol>
</section>
</div>
<div id="conventions-and-definitions">
<section id="section-2">
      <h2 id="name-conventions-and-definitions">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-and-definitions" class="section-name selfRef">Conventions and Definitions</a>
      </h2>
<div id="conformance">
<section id="section-2.1">
        <h3 id="name-conformance">
<a href="#section-2.1" class="section-number selfRef">2.1. </a><a href="#name-conformance" class="section-name selfRef">Conformance</a>
        </h3>
<p id="section-2.1-1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED",
"MAY", and "OPTIONAL" in this document are to be interpreted as
described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they
appear in all capitals, as shown here.<a href="#section-2.1-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="syntax">
<section id="section-2.2">
        <h3 id="name-syntax">
<a href="#section-2.2" class="section-number selfRef">2.2. </a><a href="#name-syntax" class="section-name selfRef">Syntax</a>
        </h3>
<p id="section-2.2-1">This document adjusts some syntax from <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>, and in doing so, relies upon the Augmented
Backus-Naur Form (ABNF) notation of <span>[<a href="#RFC5234" class="xref">RFC5234</a>]</span>.<a href="#section-2.2-1" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="monkey-patches-against-rfc6265bis">
<section id="section-3">
      <h2 id="name-monkey-patches-against-rfc6">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-monkey-patches-against-rfc6" class="section-name selfRef">Monkey-Patches against RFC6265bis</a>
      </h2>
<div id="lax-default">
<section id="section-3.1">
        <h3 id="name-lax-by-default">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-lax-by-default" class="section-name selfRef">"Lax" by Default</a>
        </h3>
<p id="section-3.1-1">The processing algorithm in Section 5.3.7 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> treats the absence of a <code>SameSite</code>
attribute in a <code>Set-Cookie</code> header as equivalent to the presence of <code>SameSite=None</code>. Cookies are
therefore available for cross-site delivery by default, and developers may opt-into more security by
setting some other value explicitly. Ideally, we'd invert that such that developers who accepted the
risks of cross-site delivery (see Section 8.2 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>) could opt into them, while
developers who didn't make any explicit choice would be protected by default.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1-2">We could accomplish this goal by first altering the processing algorithm, replacing the current step
1:<a href="#section-3.1-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-3">
<pre>
1.  Let "enforcement" be "None".
</pre><a href="#section-3.1-3" class="pilcrow">¶</a>
</div>
<p id="section-3.1-4">with the following two steps:<a href="#section-3.1-4" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-5">
<pre>
1.  Let "enforcement" be "Default".

2.  If cookie-av's attribute-value is a case-insensitive
    match for "None", set "enforcement" to "None".
</pre><a href="#section-3.1-5" class="pilcrow">¶</a>
</div>
<p id="section-3.1-6">And then by, altering step 13 of the cookie storage model (Section 5.4 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>) from:<a href="#section-3.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-7">
<pre>
13. If the cookie-attribute-list contains an attribute
    with an attribute-name of "SameSite", set the cookie's
    same-site-flag to attribute-value (i.e. either "Strict",
    "Lax", or "None"). Otherwise, set the cookie's
    same-site-flag to "None".
</pre><a href="#section-3.1-7" class="pilcrow">¶</a>
</div>
<p id="section-3.1-8">to:<a href="#section-3.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-9">
<pre>
13. If the cookie-attribute-list contains an attribute
    with an attribute-name of "SameSite" and an
    attribute-value of "Strict", "Lax", or "None", set the
    cookie's same-site-flag to attribute-value. Otherwise,
    set the cookie's same-site-flag to "Default".
</pre><a href="#section-3.1-9" class="pilcrow">¶</a>
</div>
<p id="section-3.1-10">And finally by altering the fifth bullet point of step 1 of the cookie-string construction algorithm
in Section 5.5 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> from:<a href="#section-3.1-10" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-11">
<pre>
 *  If the cookie's same-site-flag is not "None", and the HTTP
    request is cross-site (as defined in Section 5.2) then exclude
    the cookie unless all of the following statements hold:

    1.  The same-site-flag is "Lax"

    2.  The HTTP request's method is "safe".

    3.  The HTTP request's target browsing context is a top-level
        browsing context.
</pre><a href="#section-3.1-11" class="pilcrow">¶</a>
</div>
<p id="section-3.1-12">to:<a href="#section-3.1-12" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1-13">
<pre>
 *  If the cookie's same-site-flag is not "None", and the HTTP
    request is cross-site (as defined in Section 5.2) then exclude
    the cookie unless all of the following statements hold:

    1.  The same-site-flag is "Lax" or "Default".

    2.  The HTTP request's method is "safe".

    3.  The HTTP request's target browsing context is a top-level
        browsing context.
</pre><a href="#section-3.1-13" class="pilcrow">¶</a>
</div>
<p id="section-3.1-14">This would have the effect of mapping the default behavior in the absence of an explicit <code>SameSite</code>
attribute, as well as the presence of any unknown <code>SameSite</code> value, to the "Lax" behavior,
protecting developers by making cross-site delivery an explicit choice, as opposed to an implicit
default.<a href="#section-3.1-14" class="pilcrow">¶</a></p>
<div id="lax-allowing-unsafe">
<section id="section-3.1.1">
          <h4 id="name-lax-allowing-unsafe-enforce">
<a href="#section-3.1.1" class="section-number selfRef">3.1.1. </a><a href="#name-lax-allowing-unsafe-enforce" class="section-name selfRef">"Lax-Allowing-Unsafe" Enforcement</a>
          </h4>
<p id="section-3.1.1-1">The "Lax" enforcement mode described in Section 5.3.7.1 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> allows a cookie to be sent
along with cross-site requests if and only if they are top-level navigations with a "safe" HTTP
method. Implementation experience shows that this is difficult to apply across the board, and it may
be reasonable to temporarily carve out cases in which some cookies that rely on today's default
behavior can continue to be delivered as the default is shifted to "Lax" enforcement.<a href="#section-3.1.1-1" class="pilcrow">¶</a></p>
<p id="section-3.1.1-2">One such carveout, described in this section, accommodates certain cases in which it may be
desirable for a cookie to be excluded from non-top-level cross-site requests, but to be sent with
all top-level navigations regardless of HTTP request method.<a href="#section-3.1.1-2" class="pilcrow">¶</a></p>
<p id="section-3.1.1-3">For example, a login flow may involve a cross-site top-level POST request to an endpoint which
expects a cookie with login information. For such a cookie, "Lax" enforcement is not appropriate, as
it would cause the cookie to be excluded due to the unsafe HTTP request method. On the other hand,
"None" enforcement would allow the cookie to be sent with all cross-site requests. For a cookie
containing potentially sensitive login information, this may not be desirable.<a href="#section-3.1.1-3" class="pilcrow">¶</a></p>
<p id="section-3.1.1-4">In order to retain some of the protections of "Lax" enforcement (as compared to "None") while still
allowing cookies to be sent cross-site with unsafe top-level requests, user agents may choose to
provide an intermediate "Lax-allowing-unsafe" enforcement mode. A cookie whose enforcement mode is
"Lax-allowing-unsafe" will be sent along with a cross-site request if and only if it is a top-level
request, regardless of request method.<a href="#section-3.1.1-4" class="pilcrow">¶</a></p>
<p id="section-3.1.1-5">User agents may choose to apply this enforcement mode instead of "Lax" enforcement, but only in a
limited or restricted fashion. Such restrictions may include applying "Lax-allowing-unsafe" only to
cookies that did not explicitly specify <code>SameSite=Lax</code> (i.e., those whose same-site-flag was set to
"Default" by default) with creation-time more recent than a duration of the user agent's choosing (2
minutes seems reasonable).<a href="#section-3.1.1-5" class="pilcrow">¶</a></p>
<p id="section-3.1.1-6">This is done by further modifying the previously mentioned fifth bullet point of step 1 of the
cookie-string construction algorithm in Section 5.5 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> from:<a href="#section-3.1.1-6" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.1-7">
<pre>
 *  If the cookie's same-site-flag is not "None", and the HTTP
    request is cross-site (as defined in Section 5.2) then exclude
    the cookie unless all of the following statements hold:

    1.  The same-site-flag is "Lax" or "Default".

    2.  The HTTP request's method is "safe".

    3.  The HTTP request's target browsing context is a top-level
        browsing context.
</pre><a href="#section-3.1.1-7" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-8">to:<a href="#section-3.1.1-8" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.1.1-9">
<pre>
 *  If the cookie's same-site-flag is not "None", and the HTTP
    request is cross-site (as defined in Section 5.2) then exclude
    the cookie unless all of the following statements hold:

    1.  The same-site-flag is "Lax" or "Default".

    2.  The HTTP request's method is "safe", or the cookie meets
        the user agent's requirements for being granted
        "Lax-allowing-unsafe" enforcement.

    3.  The HTTP request's target browsing context is a top-level
        browsing context.
</pre><a href="#section-3.1.1-9" class="pilcrow">¶</a>
</div>
<p id="section-3.1.1-10">As a more permissive variant of "Lax" mode, "Lax-allowing-unsafe" mode necessarily provides fewer
protections against CSRF.  Ultimately, the provision of such an enforcement mode should be seen as a
temporary measure to ease adoption of "Lax" enforcement by default.<a href="#section-3.1.1-10" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="require-secure">
<section id="section-3.2">
        <h3 id="name-requiring-secure-for-samesi">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-requiring-secure-for-samesi" class="section-name selfRef">Requiring "Secure" for "SameSite=None"</a>
        </h3>
<p id="section-3.2-1">Cookies sent over plaintext HTTP are visible to anyone on the network. As section 8.3 of
<span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> points out, this visibility exposes substantial amounts of data to network attackers.
We know, for example, that long-lived and stable cookies have enabled pervasive monitoring
<span>[<a href="#RFC7258" class="xref">RFC7258</a>]</span> in the past (see Google's PREF cookie <span>[<a href="#pref-cookie" class="xref">pref-cookie</a>]</span>), and we know that a secure
transport layer provides significant confidentiality protections against this kind of attack.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2">We can, to a reasonable extent, mitigate this threat by ensuring that cookies intended for
cross-site delivery (and therefore likely to be more prevalent on the wire than cookies scoped down
to same-site requests) require secure transport.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<p id="section-3.2-3">That is, we can require that any cookie which asserts <code>SameSite=None</code> must also assert the <code>Secure</code>
attribute (Section 4.1.2.5 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>) by altering the storage model defined in Section 5.4 of
<span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>, inserting the following step after the existing step 14:<a href="#section-3.2-3" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.2-4">
<pre>
15. If the cookie's "same-site-flag" is "None", abort
    these steps and ignore the cookie entirely unless
    the cookie's secure-only-flag is true.
</pre><a href="#section-3.2-4" class="pilcrow">¶</a>
</div>
<p id="section-3.2-5">This is conceptually similar to the requirements put into place for the <code>__Secure-</code> prefix (Section
4.1.3.1 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>).<a href="#section-3.2-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="schemeful-samesite">
<section id="section-3.3">
        <h3 id="name-schemeful-same-site">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-schemeful-same-site" class="section-name selfRef">Schemeful Same-Site</a>
        </h3>
<p id="section-3.3-1">By considering the scheme as well as the registrable domain when determining whether a
given request is "same-site", the <code>SameSite</code> attribute can protect secure origins from CSRF
attacks initiated by a network attacker that can forge requests from a non-secure origin on
the same registrable domain. To do so we need to modify a number of things:<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">First change the definition of "site for cookies" from a registrable domain to
an origin. In the places where a we return an empty string for a non-existent
"site for cookies" we should instead return an origin set to a freshly
generated globally unique identifier.
Then replace the same-site calculation algorithm with the following:<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.3-3">
<pre>
Two origins, A and B, are considered same-site if the following algorithm returns true:
1.  If A and B are both scheme/host/port triples then

    1.  If A's scheme does not equal B's scheme, return false.

    2.  Let hostA be A's host, and hostB be B's host.

    3.  If hostA equals hostB and hostA's registrable domain is null, return true.

    4.  If hostA's registrable domain equals hostB's registrable domain and is non-null, return true.

2.  If A and B are both the same globally unique identifier, return true.

3.  Return false.

Note: The port component of the origins is not considered.

A request is "same-site" if its target's URI's origin
is same-site with the request's client's "site for cookies", or if the
request has no client. The request is otherwise "cross-site".
</pre><a href="#section-3.3-3" class="pilcrow">¶</a>
</div>
<p id="section-3.3-4">Now that we have a new algorithm, we can update any comparision of two sites
from "have the same registrable domain" (or "is an exact match for") to say
"is same-site".<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">Note: The request's URL when establishing a WebSockets connection has scheme "http" or "https", rather than "ws" or "wss". FETCH maps schemes when constructing the request. This mapping allows same-site cookies to be sent with WebSockets.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
</section>
</div>
<div id="origin-bound-cookies">
<section id="section-3.4">
        <h3 id="name-origin-bound-cookies">
<a href="#section-3.4" class="section-number selfRef">3.4. </a><a href="#name-origin-bound-cookies" class="section-name selfRef">Origin-Bound Cookies</a>
        </h3>
<p id="section-3.4-1">Cookies are one of the few components of the web platform that are not
scoped to the origin by default. The <code>Secure</code> attribute can scope a
cookie to secure schemes, and cookie prefixes ("__Secure-" and
"__Host-") can tighten that boundary, but these mechanisms are
little-used. Cookies that lack these protections easily move between
schemes (and even with these mechanisms will still move between ports).
The same cookies may be delivered to both the HTTP and HTTPS variants of
a given domain, even though the security properties of them differ
radically. As Section 8.6 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> points out, this gives
network attackers the ability to influence otherwise secured traffic by
modifying user state that flows to secure origins, and gives them
insight into user behavior, as securely-set cookies that lack the
<code>Secure</code> attribute likewise flow from secure origins to non-secure
origins. Additionally, cookies are delivered to all ports of a given
domain, which can't necessarily be trusted as Section 8.5 of
<span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> points out. Similarly to above, attackers operating on a
different port could influence otherwise secured traffic.<a href="#section-3.4-1" class="pilcrow">¶</a></p>
<p id="section-3.4-2">We should remedy this defect by storing both a "scheme" and "port"
component along with the cookie, and use those components in cookies'
matching algorithms to ensure that a cookie is only sent to the origin
that originally set it, thus keeping origins' state separate by default.<a href="#section-3.4-2" class="pilcrow">¶</a></p>
<p id="section-3.4-3">It's possible that a site operator purposefully wants their cookies to
be usable across ports. For these situations it seems reasonable to
allow a server to specify that a given cookie should be accessible by
different origins. Since the Domain attribute already does this, by
matching multiple hosts, we can extend it to also match all ports.
Thereby allowing a cookie with the Domain attribute, a "domain cookie",
to be accessible from any port value. This behavior extends to
overwriting cookies as well. Examples:<a href="#section-3.4-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.4-4">
<li id="section-3.4-4.1">https://example.com:123 sets a cookie: <code>Set-Cookie: a=domaincookie;
 Domain=example.com</code>. The user then visits https://example.com:456
 which sets the same cookie. This second cookie would match the
 first and then overwrite it.<a href="#section-3.4-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.4-4.2">https://example.com:123 sets a cookie <code>Set-Cookie: a=domaincookie;
 Domain=example.com</code>. The user then visits https://example.com:456
 which sets <code>Set-Cookie: a=origincookie</code>. The second cookie would
 match the first and overwrite it.<a href="#section-3.4-4.2" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.4-5">Given that these "domain cookies" are less trusted (due to their
accessibility by different hosts and ports) we should try and prevent
them from shadowing "origin cookies". Example:<a href="#section-3.4-5" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.4-6">
<li id="section-3.4-6.1">https://example.com:456 sets a cookie <code>Set-Cookie: a=origincookie</code>.
The user then visits https://example.com:123 which tries to set a
cookie <code>Set-Cookie: a=domaincookie; Domain=example.com</code>. The second
cookie would fail to be set because the cookie it's attempting to
overwrite is an origin cookie.<a href="#section-3.4-6.1" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.4-7">Finally, we don't ever want to allow a cookie to pass between schemes,
given the huge security differences between them. So there should be no
way for a server to specify that a given cookie should be sent to a
different scheme.<a href="#section-3.4-7" class="pilcrow">¶</a></p>
<p id="section-3.4-8">How we accomplish this is as follows:<a href="#section-3.4-8" class="pilcrow">¶</a></p>
<p id="section-3.4-9">First, add the concept of port matching which helps to simplify checking
if a cookie would match a port value. We can do that by adding a new
section under 5.1 (this new section depends on the modification to 5.4
below)<a href="#section-3.4-9" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-10">
<pre>
5.1.5 Port matching

An integer port-matches a given cookie if any of the following
conditions are true:
  1. The integer exactly matches the cookie's port value.

  2. The cookie's host-only-flag is false.
</pre><a href="#section-3.4-10" class="pilcrow">¶</a>
</div>
<p id="section-3.4-11">We also want to add a sub-algorithm to protect origin cookies from being
overwritten/shadowed by domain cookies. This'll be run during the
creation of new cookies in a later step.<a href="#section-3.4-11" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-12">
<pre>
5.1.6 New Cookie does not Shadow or Overwrite Origin-only Cookies

This algorithm protects any existing origin-only cookies from being
overwritten or shadowed by a new cookie ("new-cookie") with the Domain
attribute and is as follows:

If the new-cookie's host-only-flag is true, then return true.

If the new-cookie's host-only-flag is false, then return false if the
cookie store contains at least one cookie ("equiv-cookie") that meets
all of the following criteria:
  1. Equiv-cookie's name and scheme are equal to new-cookie's name and
     scheme.

  2. Equiv-cookie's host-only-flag is true.

  3. Equiv-cookie's domain domain-matches the domain of new-cookie.
  (Note: this is an asymmetrical comparison)

Otherwise return true

Notice the asymmetric comparison during the domain-matching. It can be
helpful to think of domain-matching as: "A domain-matches B when A is
equivalent to or a sub-domain of B". Since a cookie with the Domain
attribute is sent to all hosts that are equivalent to or a sub-domain
of its Domain's value, this asymmetric comparison prevents a cookie
with the Domain attribute from being set when it would be sent to any
host that also contains an origin-only cookie.

Note: This comparison intentionally ignores the "path" component. The
intent is to protect a more tightly scoped origin bound cookie across
the entire origin.

Example: https://landing.site.example sets a cookie `Set-Cookie:
a=origincookie`. The user then visits https://account.site.example
which tries to set a cookie `Set-Cookie: a=domaincookie;
Domain=site.example`. The second cookie would fail to be set because
the cookie would shadow "a=origincookie".
</pre><a href="#section-3.4-12" class="pilcrow">¶</a>
</div>
<p id="section-3.4-13">Next, alter the storage model in Section 5.4 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> by
adding "scheme" and "port" to the list of fields the user agent stores
about each cookie, and setting them. Also, let's refer to the newly
created cookie by "new-cookie" by altering step 3 of the algorithm
from:<a href="#section-3.4-13" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-14">
<pre>
3.  Create a new cookie with name cookie-name, value cookie-value. Set
    the creation-time and the last-access-time to the current date and
    time.
</pre><a href="#section-3.4-14" class="pilcrow">¶</a>
</div>
<p id="section-3.4-15">to:<a href="#section-3.4-15" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-16">
<pre>
3.  Create a new cookie ("new-cookie") with name cookie-name, value
    cookie-value. Set the creation-time and the last-access-time to the
    current date and time, set the scheme to the request-uri's origin's
    scheme component, and set the port to the request-uri's origin's
    port component.
</pre><a href="#section-3.4-16" class="pilcrow">¶</a>
</div>
<p id="section-3.4-17">References to the cookie should also be updated to use "new-cookie" in
steps 3-20 as required.<a href="#section-3.4-17" class="pilcrow">¶</a></p>
<p id="section-3.4-18">To prevent "domain cookies" from shadowing "origin cookies" we alter
step 13 from<a href="#section-3.4-18" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-19">
<pre>
13. If the cookie's secure-only-flag is false, and the scheme component
    of request-uri does not denote a "secure" protocol, then abort
    these steps and ignore the cookie entirely if the cookie store
    contains one or more cookies that meet all of the following
    criteria:

    1. Their name matches the name of the newly-created cookie.

    2. Their secure-only-flag is true.

    3. Their domain domain-matches the domain of the newly-created
       cookie, or vice-versa.

    4. The path of the newly-created cookie path-matches the path of
       the existing cookie.

    Note: The path comparison is not symmetric, ensuring only that a
    newly-created, non-secure cookie does not overlay an existing
    secure cookie, providing some mitigation against cookie-fixing
    attacks.  That is, given an existing secure cookie named 'a' with a
    path of '/login', a non-secure cookie named 'a' could be set for a
    path of '/' or '/foo', but not for a path of '/login' or
    '/login/en'.
</pre><a href="#section-3.4-19" class="pilcrow">¶</a>
</div>
<p id="section-3.4-20">to:<a href="#section-3.4-20" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-21">
<pre>
13. If the algorithm specified by 5.1.6 New Cookie does not Shadow or
    Overwrite Origin-only Cookies returns false, then abort these steps
    and ignore the cookie entirely.
</pre><a href="#section-3.4-21" class="pilcrow">¶</a>
</div>
<p id="section-3.4-22">Note: Because all cookies are now scoped by scheme it is unnecessary to
protect a secure scheme's cookies from an insecure scheme's cookies and
thus we can drop the related checks in the original step 13.<a href="#section-3.4-22" class="pilcrow">¶</a></p>
<p id="section-3.4-23">To incorporate the new fields and "domain cookie" port matching, alter
step 19 of the same algorithm from<a href="#section-3.4-23" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-24">
<pre>
19. If the cookie store contains a cookie with the same name, domain,
    host-only-flag, and path as the newly-created cookie:

    1. Let old-cookie be the existing cookie with the same name,
       domain, host-only-flag, and path as the newly-created cookie.
       (Notice that this algorithm maintains the invariant that there
       is at most one such cookie.)

    2. If the newly-created cookie was received from a "non-HTTP" API
       and the old-cookie's http-only-flag is true, abort these steps
       and ignore the newly created cookie entirely.

    3. Update the creation-time of the newly-created cookie to match
       the creation-time of the old-cookie.

    4. Remove the old-cookie from the cookie store.
</pre><a href="#section-3.4-24" class="pilcrow">¶</a>
</div>
<p id="section-3.4-25">to:<a href="#section-3.4-25" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-26">
<pre>
19. If the cookie store contains a cookie ("old-cookie") with the same
    name, scheme, domain, path, and for which either of the following
    conditions is true:

    * The old-cookie's port port-matches the new-cookie.

    * The new-cookie's port port-matches the old-cookie.

    (Notice that this algorithm maintains the invariant that there are
    no two cookies in the cookie store with the same name, scheme,
    domain, and path and for which one cookie's port port-matches the
    other cookie.)

    Then:

    1. If the newly-created cookie was received from a "non-HTTP" API
       and the old-cookie's http-only-flag is true, abort these steps
       and ignore the newly created cookie entirely.

    2. Update the creation-time of the newly-created cookie to match
       the creation-time of the old-cookie.

    3. Remove the old-cookie from the cookie store.
</pre><a href="#section-3.4-26" class="pilcrow">¶</a>
</div>
<p id="section-3.4-27">With cookie storage taken care of now we move onto sending cookies. In
section 5.5 alter step 1 from:<a href="#section-3.4-27" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-28">
<pre>
1.  Let cookie-list be the set of cookies from the cookie store that
    meets all of the following requirements:

    * Either:

      - The cookie's host-only-flag is true and the canonicalized
        request-host is identical to the cookie's domain.

      Or:

      - The cookie's host-only-flag is false and the canonicalized
        request-host domain-matches the cookie's domain.

    * The request-uri's path path-matches the cookie's path.

    * If the cookie's secure-only-flag is true, then the request-uri's
      scheme must denote a "secure" protocol (as defined by the user
      agent).

      NOTE: The notion of a "secure" protocol is not defined by this
      document.  Typically, user agents consider a protocol secure if
      the protocol makes use of transport-layer security, such as SSL
      or TLS. For example, most user agents consider "https" to be a
      scheme that denotes a secure protocol.
</pre><a href="#section-3.4-28" class="pilcrow">¶</a>
</div>
<p id="section-3.4-29">to:<a href="#section-3.4-29" class="pilcrow">¶</a></p>
<div class="artwork art-text alignLeft" id="section-3.4-30">
<pre>
19. Let cookie-list be the set of cookies from the cookie store that
    meets all of the following requirements:

    * Either:

      - The cookie's host-only-flag is true, and the canonicalized
        request-host is identical to the cookie's domain.

    Or:

      - The cookie's host-only-flag is false, and the canonicalized
        request-host domain-matches the cookie's domain.

    * The request-uri's path path-matches the cookie's path.

    * The request-uri's origin's port component port-matches the
      cookie.

    * The request-uri's origin's scheme component is identical to the
      cookie's scheme
</pre><a href="#section-3.4-30" class="pilcrow">¶</a>
</div>
<p id="section-3.4-31">At which point cookies will be bound to their origin (but have an
ability to cross port thresholds via the Domain attribute if needed).
There are remaining clean up task such as updating the "Weak
Confidentiality" and "Weak Integrity" section, modifying the eviction
algorithm to prefer domain cookies/non-secure schemes, updating
references to Secure (and its uses), etc that will need to tended to
before this can be adopted into a full specs doc.<a href="#section-3.4-31" class="pilcrow">¶</a></p>
</section>
</div>
<div id="evict-nonsecure">
<section id="section-3.5">
        <h3 id="name-evict-non-secure-cookies">
<a href="#section-3.5" class="section-number selfRef">3.5. </a><a href="#name-evict-non-secure-cookies" class="section-name selfRef">Evict Non-Secure Cookies</a>
        </h3>
<p id="section-3.5-1">In the status quo, cookies delivered to non-secure origins are, generally, quite old. Each cookies'
age is somewhat representative of its risk: long-lived cookies expose persistent identifiers to the
network when delivered non-securely which create tracking opportunities over time. Here, we aim to
mitigate this risk by substantially reducing the lifetime of non-secure cookies, thereby limiting
the window of opportunity for network attackers.<a href="#section-3.5-1" class="pilcrow">¶</a></p>
<p id="section-3.5-2">This is similar conceptually to previous proposals, notably <span>[<a href="#I-D.thomson-http-omnomnom" class="xref">I-D.thomson-http-omnomnom</a>]</span> and
<span>[<a href="#cookies-over-http-bad" class="xref">cookies-over-http-bad</a>]</span>, but seems like it might be more deployable, especially in conjunction
with the scheme changes above.<a href="#section-3.5-2" class="pilcrow">¶</a></p>
<p id="section-3.5-3">The change is straightforward, requiring the following text to be added to the bottom of Section
5.4 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>:<a href="#section-3.5-3" class="pilcrow">¶</a></p>
<p id="section-3.5-4">~~~
When "the current session is over", the user agent MUST remove from the cookie store all cookies
whose <code>scheme</code> component is non-secure.
~~<a href="#section-3.5-4" class="pilcrow">¶</a></p>
<p id="section-3.5-5">As discussed below in {#session-lifetime}, if we add a site-specific session concept, we can make
the following addition:<a href="#section-3.5-5" class="pilcrow">¶</a></p>
<p id="section-3.5-6">~~
When "the current session is over" for an origin, the user agent MUST remove from the cookie store
all cookies whose <code>scheme</code> component is non-secure, and whose <code>domain</code> component's registrable
domain matches the origin's registrable domain.
~~<a href="#section-3.5-6" class="pilcrow">¶</a></p>
<p id="section-3.5-7">This still requires the user agent to define a notion of non-secureness, but it would certainly
include "http".<a href="#section-3.5-7" class="pilcrow">¶</a></p>
</section>
</div>
<div id="session-lifetime">
<section id="section-3.6">
        <h3 id="name-session-lifetime">
<a href="#section-3.6" class="section-number selfRef">3.6. </a><a href="#name-session-lifetime" class="section-name selfRef">Session Lifetime</a>
        </h3>
<p id="section-3.6-1">Section 5.4 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> defines "the current session is over" by choosing not to define it,
instead leaving it up to the user agent. Unfortunately, we have several "session" concepts in user
agents today, and it's not clear that any of them are appropriate for cookies. HTML's
<code>sessionStorage</code> lifetime is tied to a particular top-level browsing context, thereby giving two
tabs/windows different views into a page's state. Various user agents' "private mode" create
sessions that are scoped in various ways: Chrome's Incognito mode ties a session's lifetime to the
closure of the last Incognito window, Safari's private mode's lifetime is tab-specific, etc. Session
cookies' lifetime likewise differs between user agents, in some cases based on user-visible settings
like Chrome's "Continue where you left off" (which can lead to quite persistent sessions indeed).<a href="#section-3.6-1" class="pilcrow">¶</a></p>
<p id="section-3.6-2">At some risk of further complicating the notion of a "session", it might be reasonable to learn from
existing user agents' work around meeting users' conceptions of when they're using a given site, and
to define a recommended heuristic that user agents could adopt. In particular, Chromium's site
engagement score and Safari's ITP both track a user's last moment of interaction with a site (which
might feasibly include things like navigation, clicks, scrolls, etc). This seems like a useful bit
of data to take into account, along with whether or not a user has top-level browsing contexts that
include a given site.<a href="#section-3.6-2" class="pilcrow">¶</a></p>
<p id="section-3.6-3">To that end, we could add a few concepts to <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span> to give browser vendors more clarity
around a reasonable approach to defining when "the current session is over" for a specific site,
rather that for the browsing session as a whole. Something along the following lines makes sense to
me:<a href="#section-3.6-3" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6-4">
<li id="section-3.6-4.1">User agents should store a timestamp of the last interaction with a given site in a top-level
browsing context <span>[<a href="#HTML" class="xref">HTML</a>]</span>. User agents have a great deal of flexibility in what they consider
an interaction, but typing and clicking should probably count.<a href="#section-3.6-4.1" class="pilcrow">¶</a>
</li>
          <li id="section-3.6-4.2">
            <p id="section-3.6-4.2.1">Change the "close a browsing context" algorithm <span>[<a href="#HTML" class="xref">HTML</a>]</span> to call the following algorithm between
its existing step 1 and step 2:<a href="#section-3.6-4.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6-4.2.2">
<li id="section-3.6-4.2.2.1">Let <code>closedOrigin</code> be the origin of <code>browsingContext</code>'s active document.<a href="#section-3.6-4.2.2.1" class="pilcrow">¶</a>
</li>
              <li id="section-3.6-4.2.2.2">
                <p id="section-3.6-4.2.2.2.1">For each top-level browsing context <code>c</code>:<a href="#section-3.6-4.2.2.2.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6-4.2.2.2.2">
<li id="section-3.6-4.2.2.2.2.1">If <code>c</code> is <code>browsingContext</code>, continue.<a href="#section-3.6-4.2.2.2.2.1" class="pilcrow">¶</a>
</li>
                  <li id="section-3.6-4.2.2.2.2.2">If <code>c</code>'s active document's origin is same site with <code>browsingContext</code>'s active
document's origin, return.<a href="#section-3.6-4.2.2.2.2.2" class="pilcrow">¶</a>
</li>
                </ol>
</li>
              <li id="section-3.6-4.2.2.3">ASSERT: No top-level browsing context contains a document that's same-site with the
document being closed.<a href="#section-3.6-4.2.2.3" class="pilcrow">¶</a>
</li>
              <li id="section-3.6-4.2.2.4">Return, and continue running this algorithm in parallel.<a href="#section-3.6-4.2.2.4" class="pilcrow">¶</a>
</li>
              <li id="section-3.6-4.2.2.5">Wait however long a user would reasonably expect their state to be retained (an hour
sounds reasonable).<a href="#section-3.6-4.2.2.5" class="pilcrow">¶</a>
</li>
              <li id="section-3.6-4.2.2.6">
                <p id="section-3.6-4.2.2.6.1">For each top-level browsing context <code>c</code>:<a href="#section-3.6-4.2.2.6.1" class="pilcrow">¶</a></p>
<ol start="1" type="1" class="normal type-1" id="section-3.6-4.2.2.6.2">
<li id="section-3.6-4.2.2.6.2.1">If <code>c</code>'s active document's origin is same site with <code>closedOrigin</code>, return.<a href="#section-3.6-4.2.2.6.2.1" class="pilcrow">¶</a>
</li>
                </ol>
</li>
              <li id="section-3.6-4.2.2.7">ASSERT: No top-level browsing context contains a document that's same-site with the
document that was closed.<a href="#section-3.6-4.2.2.7" class="pilcrow">¶</a>
</li>
              <li id="section-3.6-4.2.2.8">Trigger "the current session is over" for <code>closedOrigin</code>.<a href="#section-3.6-4.2.2.8" class="pilcrow">¶</a>
</li>
            </ol>
</li>
          <li id="section-3.6-4.3">Define a new handler for "the current session is over" that takes an origin into account, and
clears session cookies for that origin's site.<a href="#section-3.6-4.3" class="pilcrow">¶</a>
</li>
        </ol>
<p id="section-3.6-5">Note that these definitions refer to "site", not "origin", as cookies span an entire registrable
domain. Ideally, we'll address that too, but not today.<a href="#section-3.6-5" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="security-and-privacy-considerations">
<section id="section-4">
      <h2 id="name-security-and-privacy-consid">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-security-and-privacy-consid" class="section-name selfRef">Security and Privacy Considerations</a>
      </h2>
<div id="csrf">
<section id="section-4.1">
        <h3 id="name-csrf">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-csrf" class="section-name selfRef">CSRF</a>
        </h3>
<p id="section-4.1-1"><code>SameSite</code> is a reasonably robust defense against some classes of cross-site request forgery
attacks, as described in Section 8.8.1 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>, but developers need to opt-into its
protections in order for them to have any effect. That is, developers are vulnerable to CSRF
attacks by default, and must do some work to shift themselves into a more defensible position.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">The change proposed in <a href="#lax-default" class="xref">Section 3.1</a> would invert that requirement, placing the burden on the
small number of developers who are building services that require state in cross-site requests.
Those developers would be empowered to opt-into the status quo's less-secure model, while developers
who don't intend for their projects to be embedded in cross-site contexts are protected by default.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="secure-transport">
<section id="section-4.2">
        <h3 id="name-secure-transport">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-secure-transport" class="section-name selfRef">Secure Transport</a>
        </h3>
<p id="section-4.2-1">As discussed in Section 8.3 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>, cookies delivered over plaintext channels are
exposed to intermediaries, and thereby enable pervasive monitoring <span>[<a href="#RFC7258" class="xref">RFC7258</a>]</span>. The change proposed
in <a href="#require-secure" class="xref">Section 3.2</a> above would set secure transport as a baseline requirement for all stateful
cross-site requests, thereby reducing the risk that these cookies can be cataloged or modified by
network attackers.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">Requiring secure transport for cookies intended for cross-site usage has the exciting secondary
effect of increasing pressure on entities that produce embeddable content to migrate their
products to HTTPS. That has security benefits for those third-party products themselves, but also
has the effect of removing the potential of mixed content (<span>[<a href="#mixed-content" class="xref">mixed-content</a>]</span>) as a blocker to
first-party migration to HTTPS.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Note that in the long term, it seems quite reasonable to take the additional step of requiring the
<code>Secure</code> attribute for all cookies, regardless of their <code>SameSite</code> value. That would have more
substantial impact on pervasive monitoring and network attackers generally. This document's proposal
limits itself to <code>SameSite=None</code> because that seems like a low-hanging, high-value change that's
deployable in the near term. User agents are encouraged to find additional subsets for which
<code>Secure</code> can be required.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="tracking">
<section id="section-4.3">
        <h3 id="name-tracking">
<a href="#section-4.3" class="section-number selfRef">4.3. </a><a href="#name-tracking" class="section-name selfRef">Tracking</a>
        </h3>
<p id="section-4.3-1">The proposals in this document do not in themselves mitigate the privacy risks described in Section
7.1 of <span>[<a href="#RFC6265bis" class="xref">RFC6265bis</a>]</span>. Entities who wish to use cookies to track user activity from cross-site
contexts can continue to do so by setting cookies that declare themselves as <code>SameSite=None</code>.<a href="#section-4.3-1" class="pilcrow">¶</a></p>
<p id="section-4.3-2">Requiring that explicit declaration, however, gives user agents the ability to easily distinguish
cookies used for stateful cross-site requests from those with narrower scope. After the change
proposed in <a href="#lax-default" class="xref">Section 3.1</a>, only those cookies that make an explicit <code>SameSite=None</code> declaration
can be directly used for cross-site tracking. It may make sense for user agents to use that
information to give users different controls for these cookies, or to apply different policies for
expiration and delivery.<a href="#section-4.3-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="implementation-considerations">
<section id="section-5">
      <h2 id="name-implementation-consideratio">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-implementation-consideratio" class="section-name selfRef">Implementation Considerations</a>
      </h2>
<div id="sequencing">
<section id="section-5.1">
        <h3 id="name-sequencing">
<a href="#section-5.1" class="section-number selfRef">5.1. </a><a href="#name-sequencing" class="section-name selfRef">Sequencing</a>
        </h3>
<p id="section-5.1-1">The steps described in this document don't need to be taken at the same time. It's quite possible
that it will be less disruptive to deploy <code>SameSite=Lax</code> as a default first, then to require the
<code>Secure</code> attribute for any explicitly <code>SameSite=None</code> cookie as a subsequent step, and then
deploying schemeful same-site in a final step.<a href="#section-5.1-1" class="pilcrow">¶</a></p>
<p id="section-5.1-2">User agents are encouraged to adopt these recommendations in whatever order they believe will lead
to the widest, most expedient deployment.<a href="#section-5.1-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="deployment">
<section id="section-5.2">
        <h3 id="name-deployment">
<a href="#section-5.2" class="section-number selfRef">5.2. </a><a href="#name-deployment" class="section-name selfRef">Deployment</a>
        </h3>
<p id="section-5.2-1">It's possible that a middle-ground between <code>SameSite=Lax</code> and <code>SameSite=None</code> could be a better
balance between doing what developers want by default, and mitigating CSRF by default.
<span>[<a href="#I-D.west-cookie-samesite-firstparty" class="xref">I-D.west-cookie-samesite-firstparty</a>]</span> explores the possibility of integrating First-Party Sets
<span>[<a href="#first-party-set" class="xref">first-party-set</a>]</span> with the <code>SameSite</code> attribute in order to allow entities that shard themselves
across multiple registrable domains to maintain stateful communication between them (to support
single-sign on, for example).<a href="#section-5.2-1" class="pilcrow">¶</a></p>
<p id="section-5.2-2">It's possible that user agents who support First-Party Sets could reduce the deployment overhead
for developers, and increase the robustness of a site's CSRF defense for
cross-site-but-not-cross-party cookies by defaulting to something like that document's
<code>FirstPartyLax</code> instead of <code>Lax</code>.<a href="#section-5.2-2" class="pilcrow">¶</a></p>
</section>
</div>
</section>
</div>
<div id="iana-considerations">
<section id="section-6">
      <h2 id="name-iana-considerations">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-6-1">This document has no IANA actions.<a href="#section-6-1" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-7">
      <h2 id="name-references">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-7.1">
        <h3 id="name-normative-references">
<a href="#section-7.1" class="section-number selfRef">7.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="HTML">[HTML]</dt>
        <dd>
<span class="refTitle">"HTML"</span>, <span>n.d.</span>, <span>&lt;<a href="https://html.spec.whatwg.org/">https://html.spec.whatwg.org/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5234">[RFC5234]</dt>
        <dd>
<span class="refAuthor">Crocker, D., Ed.</span> and <span class="refAuthor">P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">STD 68</span>, <span class="seriesInfo">RFC 5234</span>, <span class="seriesInfo">DOI 10.17487/RFC5234</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC6265bis">[RFC6265bis]</dt>
        <dd>
<span class="refAuthor">West, M.</span> and <span class="refAuthor">J. Wilander</span>, <span class="refTitle">"Cookies: HTTP State Management Mechanism"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-ietf-httpbis-rfc6265bis-07</span>, <time datetime="2020-12-07" class="refDate">7 December 2020</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-ietf-httpbis-rfc6265bis-07.txt">https://www.ietf.org/archive/id/draft-ietf-httpbis-rfc6265bis-07.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-7.2">
        <h3 id="name-informative-references">
<a href="#section-7.2" class="section-number selfRef">7.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="cookies-over-http-bad">[cookies-over-http-bad]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"Cookies over HTTP Bad"</span>, <time datetime="2018-04" class="refDate">April 2018</time>, <span>&lt;<a href="https://github.com/mikewest/cookies-over-http-bad">https://github.com/mikewest/cookies-over-http-bad</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="first-party-set">[first-party-set]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"First-Party Sets"</span>, <span>n.d.</span>, <span>&lt;<a href="https://mikewest.github.io/first-party-sets/">https://mikewest.github.io/first-party-sets/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="HTTP-Workshop-2019">[HTTP-Workshop-2019]</dt>
        <dd>
<span class="refAuthor">Nottingham, M.</span>, <span class="refTitle">"HTTP Workshop 2019: Report"</span>, <time datetime="2019-04" class="refDate">April 2019</time>, <span>&lt;<a href="https://github.com/HTTPWorkshop/workshop2019/wiki/Report">https://github.com/HTTPWorkshop/workshop2019/wiki/Report</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.thomson-http-omnomnom">[I-D.thomson-http-omnomnom]</dt>
        <dd>
<span class="refAuthor">Thomson, M.</span> and <span class="refAuthor">C. Peterson</span>, <span class="refTitle">"Expiring Aggressively Those HTTP Cookies"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-thomson-http-omnomnom-00</span>, <time datetime="2016-05-26" class="refDate">26 May 2016</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-thomson-http-omnomnom-00.txt">https://www.ietf.org/archive/id/draft-thomson-http-omnomnom-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.west-cookie-samesite-firstparty">[I-D.west-cookie-samesite-firstparty]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"First-Party Sets and SameSite Cookies"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-west-cookie-samesite-firstparty-01</span>, <time datetime="2019-05-10" class="refDate">10 May 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-west-cookie-samesite-firstparty-01.txt">https://www.ietf.org/archive/id/draft-west-cookie-samesite-firstparty-01.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="I-D.west-http-state-tokens">[I-D.west-http-state-tokens]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"HTTP State Tokens"</span>, <span class="refContent">Work in Progress</span>, <span class="seriesInfo">Internet-Draft, draft-west-http-state-tokens-00</span>, <time datetime="2019-03-28" class="refDate">28 March 2019</time>, <span>&lt;<a href="https://www.ietf.org/archive/id/draft-west-http-state-tokens-00.txt">https://www.ietf.org/archive/id/draft-west-http-state-tokens-00.txt</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="mixed-content">[mixed-content]</dt>
        <dd>
<span class="refAuthor">West, M.</span>, <span class="refTitle">"Mixed Content"</span>, <span>n.d.</span>, <span>&lt;<a href="https://w3c.github.io/webappsec-mixed-content/">https://w3c.github.io/webappsec-mixed-content/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="pref-cookie">[pref-cookie]</dt>
        <dd>
<span class="refAuthor">Soltani, A.</span>, <span class="refAuthor">Peterson, A.</span>, and <span class="refAuthor">B. Gellman</span>, <span class="refTitle">"NSA uses Google cookies to pinpoint targets for hacking"</span>, <time datetime="2013-12" class="refDate">December 2013</time>, <span>&lt;<a href="https://www.washingtonpost.com/news/the-switch/wp/2013/12/10/nsa-uses-google-cookies-to-pinpoint-targets-for-hacking/">https://www.washingtonpost.com/news/the-switch/wp/2013/12/10/nsa-uses-google-cookies-to-pinpoint-targets-for-hacking/</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC7258">[RFC7258]</dt>
      <dd>
<span class="refAuthor">Farrell, S.</span> and <span class="refAuthor">H. Tschofenig</span>, <span class="refTitle">"Pervasive Monitoring Is an Attack"</span>, <span class="seriesInfo">BCP 188</span>, <span class="seriesInfo">RFC 7258</span>, <span class="seriesInfo">DOI 10.17487/RFC7258</span>, <time datetime="2014-05" class="refDate">May 2014</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc7258">https://www.rfc-editor.org/info/rfc7258</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">Conversations with a number of folks at 2019's HTTP Workshop helped me clarify my thinking around
the incremental improvements we can make to cookies. In particular, Martin Thomson and Anne van
Kesteren provided insightful feedback.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
<p id="section-appendix.a-2">Lily Chen has been instrumental in initial deployments of the <code>SameSite</code> changes described in 
<a href="#lax-default" class="xref">Section 3.1</a> and <a href="#require-secure" class="xref">Section 3.2</a>, proving that incremental changes to cookies can be
successfully shipped.<a href="#section-appendix.a-2" class="pilcrow">¶</a></p>
<p id="section-appendix.a-3">Steven Bingler contributed the "Schemeful SameSite" proposal described in <a href="#schemeful-samesite" class="xref">Section 3.3</a>.<a href="#section-appendix.a-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Mike West</span></div>
<div dir="auto" class="left"><span class="org">Google</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:mkwst@google.com" class="email">mkwst@google.com</a>
</div>
<div class="url">
<span>URI:</span>
<a href="https://www.mikewest.org/" class="url">https://www.mikewest.org/</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
